@model IEnumerable<nhom6.Order>

@{
    ViewBag.Title = "ListOrder";
    Layout = "~/Areas/Admin/Views/Shared/adminLayout.cshtml";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<h2>Danh sách đơn hàng</h2>
<table class="table table-bordered">
    <tr>
        <th>ID đơn hàng</th>
        <th>Tên khách hàng</th>
        <th>Ngày đặt</th>
        <th>Tổng tiền</th>
        <th>Hình thức thanh toán</th>
        <th>Trạng thái</th>
        <th>Hành động</th>
    </tr>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.OrderID</td>
            <td>@item.Customer.CustomerName</td>  Nếu có navigation property
            <td>@(item.OrderDate != null ? item.OrderDate.Value.ToString("yyyy-MM-dd") : "Chưa có")</td>
            <td>@item.TotalPrice VND</td>
            <td>@item.PaidStatu.PaidStatus</td>
            <td>
                <select class="form-select status-dropdown" data-order-id="@item.OrderID">
                    <option value="Chờ xác nhận" @(item.PaidStatu.PaidStatus == "Chờ xác nhận" ? "selected" : "")>Chờ xác nhận</option>
                    <option value="Đã xác nhận" @(item.PaidStatu.PaidStatus == "Đã xác nhận" ? "selected" : "")>Đã xác nhận</option>

                </select>
            </td>

            // chạy được
            <td>
                <a href="@Url.Action("Accept", "Order", new { id = item.OrderID })" class="btn btn-success">Chấp nhận</a>
                @*<a href="@Url.Action("Cancel", "Order", new { id = item.OrderID })" class="btn btn-danger">Hủy</a>*@
                <a href="javascript:void(0);" data-order-id="@item.OrderID" class="btn btn-danger">Hủy</a>
            </td>

        </tr>
    }
</table>

@section Script{
    <script>
        $(document).ready(function () {
            $(".btn-danger").click(function (e) {
                e.preventDefault(); // Ngừng hành động mặc định của nút

                var button = $(this); // Nút bấm
                var orderId = button.data("order-id"); // Lấy ID của đơn hàng từ data attribute

                // Hiển thị hộp thoại xác nhận
                if (confirm("Bạn muốn hủy đơn hàng này?")) {
                    // Nếu người dùng chọn OK, gửi yêu cầu xóa qua AJAX
                    $.ajax({
                        url: "/Admin/Admin/Cancel", // URL của action xóa đơn hàng
                        type: "POST",
                        data: { id: orderId },
                        success: function (response) {
                            if (response.success) {
                                alert("Đơn hàng đã bị hủy.");
                                location.reload(); // Làm mới trang để hiển thị lại danh sách đơn hàng
                            } else {
                                alert("Có lỗi xảy ra, vui lòng thử lại.");
                            }
                        },
                        error: function () {
                            alert("Có lỗi xảy ra, vui lòng thử lại.");
                        }
                    });
                }
            });
        });
    </script>
}
